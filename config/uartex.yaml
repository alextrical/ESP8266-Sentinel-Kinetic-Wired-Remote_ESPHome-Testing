esphome:
  name: display-test

esp32:
  variant: esp32s3
  board: esp32-s3-devkitc-1
  framework:
    type: esp-idf

logger:
  hardware_uart : UART0
  level: VERY_VERBOSE
  logs:
    component: ERROR

uart:
  id: uart_bus
  tx_pin: GPIO1
  rx_pin: GPIO2
  baud_rate: 9600

# External component for UART data processing
external_components:
#   - source: github://eigger/espcomponents@latest
#     components: [ uartex ]
#     refresh: always
  - source: components

uartex:
  rx_timeout: 10ms
  rx_header: [0x02]  # Header included in checksum
  rx_checksum2: !lambda |-
    uint16_t crc = 0xFFFF - 0x02;
    for (int i = 0; i < len; i++) crc -= data[i];
    //ESP_LOGD("main", "Value1: 0x%02X, Value2: 0x%02X", static_cast<uint8_t>(crc >> 8), static_cast<uint8_t>(crc));
    return { static_cast<uint8_t>(crc >> 8), static_cast<uint8_t>(crc) };

text_sensor:
  # Raw string from UART (read once)
  - platform: uartex
    name: LCD_RAW
    id: "lcd_raw"
    lambda: 'return std::string(reinterpret_cast<const char*>(data + 5), 33);'